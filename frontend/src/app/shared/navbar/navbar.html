<!-- Mobile top header -->
<header class="md:hidden fixed top-0 left-0 w-full bg-[#1e293b] z-50 border-b border-gray-800/60">
  <div class="flex items-center justify-between px-4 h-14">
    <div class="flex items-baseline gap-1.5">
      <span class="text-lg font-semibold text-white">Time<span class="text-blue-400">2</span>Log</span>
      <span class="text-xs text-gray-500">App</span>
    </div>

    @if (authService.isAuthenticated()) {
      <div class="flex items-center gap-2">

        <!-- Language toggle pill -->
        <div class="relative">
          <button
            (click)="toggleLangMenu()"
            class="flex items-center gap-1.5 h-8 px-3 rounded-full bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:bg-white/10 transition-all text-xs font-semibold uppercase tracking-wider"
          >
            <svg class="w-3.5 h-3.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            {{ currentLang.code }}
          </button>

          @if (isLangMenuOpen()) {
            <div
              class="fixed inset-0 z-40"
              (click)="toggleLangMenu()"
              (keyup.escape)="toggleLangMenu()"
              tabindex="0"
              role="button"
              aria-label="Close menu"
            ></div>
            <div class="absolute top-full right-0 mt-2 bg-[#1a2332] border border-gray-700/60 rounded-2xl shadow-2xl z-50 overflow-hidden min-w-[160px]">
              @for (lang of languages; track lang.code) {
                <button
                  (click)="switchLanguage(lang.code)"
                  class="w-full flex items-center gap-3 px-4 py-3 text-sm text-left transition-colors"
                  [class.bg-blue-600]="languageService.currentLang === lang.code"
                  [class.text-white]="languageService.currentLang === lang.code"
                  [class.text-gray-300]="languageService.currentLang !== lang.code"
                  [class.hover:bg-white/5]="languageService.currentLang !== lang.code"
                >
                  <span class="text-base">{{ lang.code === 'de' ? 'ðŸ‡©ðŸ‡ª' : 'ðŸ‡¬ðŸ‡§' }}</span>
                  <span class="flex-1">{{ lang.label }}</span>
                  @if (languageService.currentLang === lang.code) {
                    <svg class="w-4 h-4 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 0 1 0 1.414l-8 8a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L8 12.586l7.293-7.293a1 1 0 0 1 1.414 0z" clip-rule="evenodd"/>
                    </svg>
                  }
                </button>
              }
            </div>
          }
        </div>

        <!-- Logout button -->
        <button
          (click)="logout()"
          class="flex items-center justify-center w-8 h-8 rounded-full bg-white/5 border border-white/10 text-gray-400 hover:text-red-400 hover:border-red-400/30 hover:bg-red-500/10 transition-all"
          [attr.aria-label]="'auth.logout' | translate"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>

      </div>
    }
  </div>
</header>

<!-- Sidebar (desktop) + Bottom tab bar (mobile) -->
<aside
  class="fixed bottom-0 left-0 w-full bg-[#1e293b] border-t border-gray-800/60 flex flex-col z-50 md:sticky md:top-0 md:w-64 md:h-screen md:border-t-0 md:border-r md:border-gray-800"
>
  <!-- Desktop logo -->
  <div class="hidden md:block p-6">
    <div class="pl-6">
      <div class="text-2xl font-semibold text-white">
        Time<span class="text-blue-400">2</span>Log
      </div>
      <span class="text-xs text-gray-500 block">App</span>
    </div>
    <hr class="border-gray-700/50 mt-4" />
  </div>

  <!-- Nav -->
  <nav class="flex flex-row md:flex-col flex-1 justify-around md:justify-start items-stretch md:px-4 md:space-y-2">
    @if (authService.isAuthenticated()) {

      <!-- Dashboard -->
      <a
        routerLink="/dashboard"
        #dashboardLink="routerLinkActive"
        routerLinkActive="text-blue-400 md:bg-[#2d3a4f]"
        class="relative flex flex-col md:flex-row items-center justify-center md:justify-start py-2.5 md:py-3 md:px-4 md:rounded-lg flex-1 md:flex-none font-medium transition-all text-gray-500 md:text-gray-300 hover:md:bg-[#2d3a4f]/50 hover:md:text-gray-200"
      >
        <!-- Active indicator line (mobile only) -->
        <span
          class="absolute top-0 inset-x-0 flex justify-center md:hidden pointer-events-none transition-opacity"
          [class.opacity-100]="dashboardLink.isActive"
          [class.opacity-0]="!dashboardLink.isActive"
        >
          <span class="w-8 h-0.5 bg-blue-400 rounded-full"></span>
        </span>
        <!-- Icon: grid -->
        <svg class="w-5 h-5 md:w-[18px] md:h-[18px] md:mr-3 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
        <span class="text-[10px] md:text-sm mt-1 md:mt-0 leading-tight">{{ 'nav.dashboard' | translate }}</span>
      </a>

      <!-- EintrÃ¤ge -->
      <a
        routerLink="/activities"
        #entriesLink="routerLinkActive"
        routerLinkActive="text-blue-400 md:bg-[#2d3a4f]"
        class="relative flex flex-col md:flex-row items-center justify-center md:justify-start py-2.5 md:py-3 md:px-4 md:rounded-lg flex-1 md:flex-none font-medium transition-all text-gray-500 md:text-gray-300 hover:md:bg-[#2d3a4f]/50 hover:md:text-gray-200"
      >
        <span
          class="absolute top-0 inset-x-0 flex justify-center md:hidden pointer-events-none transition-opacity"
          [class.opacity-100]="entriesLink.isActive"
          [class.opacity-0]="!entriesLink.isActive"
        >
          <span class="w-8 h-0.5 bg-blue-400 rounded-full"></span>
        </span>
        <!-- Icon: list -->
        <svg class="w-5 h-5 md:w-[18px] md:h-[18px] md:mr-3 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <line x1="8" y1="6" x2="21" y2="6"/>
          <line x1="8" y1="12" x2="21" y2="12"/>
          <line x1="8" y1="18" x2="21" y2="18"/>
          <circle cx="3" cy="6" r="0.5" fill="currentColor"/>
          <circle cx="3" cy="12" r="0.5" fill="currentColor"/>
          <circle cx="3" cy="18" r="0.5" fill="currentColor"/>
        </svg>
        <span class="text-[10px] md:text-sm mt-1 md:mt-0 leading-tight">{{ 'nav.entries' | translate }}</span>
      </a>

      <!-- Settings (mobile tab only) -->
      <a
        routerLink="/settings"
        #settingsMobileLink="routerLinkActive"
        routerLinkActive="text-blue-400"
        class="relative flex flex-col items-center justify-center py-2.5 flex-1 font-medium transition-all text-gray-500 md:hidden"
      >
        <span
          class="absolute top-0 inset-x-0 flex justify-center pointer-events-none transition-opacity"
          [class.opacity-100]="settingsMobileLink.isActive"
          [class.opacity-0]="!settingsMobileLink.isActive"
        >
          <span class="w-8 h-0.5 bg-blue-400 rounded-full"></span>
        </span>
        <!-- Icon: settings gear -->
        <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        <span class="text-[10px] mt-1 leading-tight">{{ 'settings.title' | translate }}</span>
      </a>

    }
  </nav>

  <!-- Desktop bottom section: language, settings, logout -->
  <div class="hidden md:block p-4 border-t border-gray-800 space-y-1">
    <!-- Language -->
    <div class="relative">
      @if (isLangMenuOpen()) {
        <div
          class="fixed inset-0 z-40"
          (click)="toggleLangMenu()"
          (keyup.escape)="toggleLangMenu()"
          tabindex="0"
          role="button"
          aria-label="Close menu"
        ></div>
      }
      <button
        (click)="toggleLangMenu()"
        class="relative z-50 w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-gray-400 hover:text-white hover:bg-[#2d3a4f] rounded-lg transition-all"
      >
        <div class="flex items-center gap-3">
          <svg class="w-[18px] h-[18px] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <line x1="2" y1="12" x2="22" y2="12"/>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
          </svg>
          <span class="uppercase text-xs tracking-wider">{{ currentLang.code }}</span>
        </div>
        <svg
          class="w-4 h-4 transition-transform duration-200"
          [class.rotate-180]="isLangMenuOpen()"
          fill="none" stroke="currentColor" viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      @if (isLangMenuOpen()) {
        <div class="absolute bottom-full left-0 mb-2 w-full bg-[#2d3a4f] border border-gray-700 rounded-lg shadow-2xl z-50 overflow-hidden">
          @for (lang of languages; track lang.code) {
            <button
              (click)="switchLanguage(lang.code)"
              class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-left transition-colors"
              [class.bg-blue-600]="languageService.currentLang === lang.code"
              [class.text-white]="languageService.currentLang === lang.code"
              [class.text-gray-300]="languageService.currentLang !== lang.code"
            >
              <span>{{ lang.code === 'de' ? 'ðŸ‡©ðŸ‡ª' : 'ðŸ‡¬ðŸ‡§' }}</span>
              <span>{{ lang.label }}</span>
            </button>
          }
        </div>
      }
    </div>

    @if (authService.isAuthenticated()) {
      <button
        (click)="settings()"
        class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-[#2d3a4f]/50 hover:text-gray-200 transition-colors"
      >
        <svg class="w-[18px] h-[18px] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        <span>{{ 'settings.title' | translate }}</span>
      </button>

      <button
        (click)="logout()"
        class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-[#2d3a4f]/50 hover:text-red-400 transition-colors"
      >
        <svg class="w-[18px] h-[18px] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        <span>{{ 'auth.logout' | translate }}</span>
      </button>
    }
  </div>
</aside>